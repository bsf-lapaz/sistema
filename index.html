<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIG-BSF | T√°ctico</title>
<style>
  /* --- ESTILOS T√ÅCTICOS MODERNOS --- */
  :root {
    --verde-comando: #0a2e18;
    --verde-brillante: #00ff55;
    --oro: #FFD700;
    --negro-transparente: rgba(0, 20, 0, 0.85);
    --vidrio: rgba(255, 255, 255, 0.95);
  }
  
  body { 
    font-family: 'Segoe UI', Roboto, sans-serif; 
    margin: 0; padding: 0; user-select: none;
    /* FONDO DE OPERACIONES (Imagen T√°ctica de fondo) */
    background: url('https://img.freepik.com/free-photo/police-car-lights-night-city-street_146671-19614.jpg?t=st=1710000000~exp=1710003600~hmac=abcdef') no-repeat center center fixed; 
    background-size: cover;
    background-color: #05110a; /* Color de respaldo */
    color: #333;
  }
  
  /* Capa oscura sobre la imagen para que se lea el texto */
  body::before {
    content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(to bottom, rgba(0,30,10,0.9), rgba(0,10,0,0.95));
    z-index: -1;
  }

  .hidden { display: none !important; }

  /* --- ANIMACIONES --- */
  @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(243, 195, 0, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(243, 195, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(243, 195, 0, 0); } }

  /* PANTALLA LOGIN */
  #view-login { 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; 
    backdrop-filter: blur(8px);
  }
  .login-card { 
    background: rgba(0, 40, 20, 0.8); 
    padding: 40px; border-radius: 20px; 
    width: 80%; max-width: 320px; 
    border: 1px solid rgba(0, 255, 85, 0.3); 
    box-shadow: 0 0 30px rgba(0, 255, 85, 0.1);
    text-align: center;
    animation: slideIn 0.5s ease-out;
  }
  .login-input { 
    width: 100%; padding: 15px; margin: 20px 0; border: none; border-radius: 30px; 
    text-align: center; font-weight: bold; font-size: 16px; outline: none;
    background: rgba(255,255,255,0.9); box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
  }
  .login-btn { 
    width: 100%; padding: 15px; background: var(--oro); color: var(--verde-comando); 
    border: none; border-radius: 30px; font-weight: 900; font-size: 16px; cursor: pointer; 
    text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    transition: transform 0.2s;
  }
  .login-btn:active { transform: scale(0.95); }

  /* CABECERA FLOTANTE */
  .header { 
    background: rgba(0, 56, 30, 0.95); 
    backdrop-filter: blur(10px);
    color: white; padding: 10px 15px; 
    border-bottom: 3px solid var(--oro); 
    display: flex; align-items: center; justify-content: space-between; 
    position: sticky; top: 0; z-index: 100; 
    box-shadow: 0 5px 20px rgba(0,0,0,0.5);
  }
  .header-logo { height: 50px; width: auto; filter: drop-shadow(0 0 5px rgba(255,255,255,0.3)); }
  .header-text { text-align: center; flex-grow: 1; }
  .header h1 { margin: 0; font-size: 15px; font-weight: 900; letter-spacing: 1px; text-shadow: 0 2px 4px black; }
  .header p { margin: 0; font-size: 10px; color: var(--oro); font-weight: bold; }

  .container { padding: 20px 15px; max-width: 600px; margin: 0 auto; padding-bottom: 80px; }

  /* BOTONES Y TARJETAS (Efecto Vidrio) */
  .btn-back { 
    background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);
    padding: 10px 20px; border-radius: 30px; margin-bottom: 20px; cursor: pointer; 
    display: inline-flex; align-items: center; font-weight: bold; font-size: 13px; 
    backdrop-filter: blur(5px); transition: background 0.3s;
  }
  .btn-back:hover { background: rgba(255,255,255,0.2); }

  .section-title { 
    color: var(--oro); border-left: 5px solid var(--oro); padding-left: 15px; 
    margin-bottom: 25px; font-size: 20px; font-weight: 800; text-transform: uppercase; 
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
  }

  .bank-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
  .bank-btn { 
    background: var(--vidrio); border: none; padding: 25px 10px; border-radius: 15px; 
    box-shadow: 0 10px 20px rgba(0,0,0,0.2); cursor: pointer; 
    display: flex; flex-direction: column; align-items: center; 
    border-bottom: 4px solid transparent; 
    animation: slideIn 0.4s ease-out; /* Animaci√≥n de entrada */
  }
  .bank-btn:active { transform: scale(0.96); border-bottom: 4px solid var(--oro); }
  .bank-icon { font-size: 35px; margin-bottom: 10px; filter: drop-shadow(0 4px 2px rgba(0,0,0,0.2)); }
  .bank-name { font-weight: 900; color: var(--verde-comando); font-size: 12px; text-transform: uppercase; }

  .agency-list { display: flex; flex-direction: column; gap: 12px; }
  .agency-btn { 
    background: var(--vidrio); padding: 20px; border-radius: 12px; 
    border-left: 6px solid var(--verde-comando); cursor: pointer; 
    display: flex; justify-content: space-between; align-items: center; 
    box-shadow: 0 5px 15px rgba(0,0,0,0.1); animation: slideIn 0.3s ease-out;
  }

  /* DETALLE OPERATIVO */
  .detail-card { 
    background: var(--vidrio); border-radius: 16px; overflow: hidden; 
    box-shadow: 0 20px 50px rgba(0,0,0,0.3); animation: slideIn 0.3s ease-out;
  }
  .detail-header { 
    background: linear-gradient(135deg, var(--verde-comando), #001a00); 
    color: white; padding: 25px; position: relative;
  }
  /* Icono de fondo decorativo */
  .detail-header::after {
    content: "üõ°Ô∏è"; position: absolute; right: 10px; bottom: -10px; font-size: 80px; opacity: 0.1;
  }
  
  .officer-card { 
    background: white; border-left: 5px solid #0056b3; 
    border-radius: 8px; padding: 15px; margin-bottom: 15px; position: relative; 
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  .officer-name { font-weight: 800; color: var(--verde-comando); font-size: 14px; display: block; margin-bottom: 5px; }
  
  /* Botones de Acci√≥n Vibrantes */
  .btn-call-mini { 
    position: absolute; right: 10px; top: 15px; 
    background: linear-gradient(to right, #28a745, #218838); color: white; 
    padding: 8px 15px; border-radius: 20px; text-decoration: none; font-size: 11px; font-weight: 800; 
    display: flex; align-items: center; gap: 5px; box-shadow: 0 3px 6px rgba(0,0,0,0.2); 
  }
  .btn-map { 
    background: linear-gradient(to right, #dc3545, #c82333); color: white; 
    display: block; padding: 16px; text-align: center; text-decoration: none; 
    border-radius: 12px; font-weight: 800; font-size: 15px; 
    text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 5px 15px rgba(220,53,69,0.4); 
    margin-top: 20px; animation: pulse 2s infinite; /* Efecto latido */
  }

  #loader, #error-screen { text-align: center; padding: 60px 20px; color: #ccc; font-weight: 600; text-shadow: 0 2px 4px black; }
  .error-box { background: rgba(255,200,200,0.9); border: 2px solid #900; color: #500; padding: 20px; border-radius: 10px; font-size: 13px; text-align: left; }
</style>
</head>
<body>

<div id="view-login">
  <div class="login-card">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/Escudo_de_la_Polic%C3%ADa_Boliviana.png/150px-Escudo_de_la_Polic%C3%ADa_Boliviana.png" style="width:90px; margin-bottom:20px; filter: drop-shadow(0 0 10px gold);">
    <h2 style="margin:0; color:var(--oro); font-size:20px; font-weight:900; letter-spacing:1px;">ACCESO T√ÅCTICO</h2>
    <p style="color:#ddd; margin-bottom:25px; font-size:11px;">SISTEMA GEOGESTI√ìN BSF</p>
    <input type="password" id="pass-input" class="login-input" placeholder="INGRESE C√ìDIGO">
    <button class="login-btn" onclick="checkPassword()">AUTENTICAR</button>
    <div id="login-error" style="color:#ff8888; font-weight:bold; margin-top:15px; display:none; text-shadow: 0 1px 2px black;">‚õî C√ìDIGO ERR√ìNEO</div>
  </div>
</div>

<div id="app-container" class="hidden">
  
  <div class="header">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/Escudo_de_la_Polic%C3%ADa_Boliviana.png/100px-Escudo_de_la_Polic%C3%ADa_Boliviana.png" class="header-logo">
    <div class="header-text">
      <h1>BATALL√ìN LA PAZ</h1>
      <p>SEGURIDAD F√çSICA ESTATAL</p>
    </div>
    <img src="logo.png" class="header-logo" onerror="this.style.opacity='0'">
  </div>

  <div class="container">
    <div id="loader">üîÑ ESTABLECIENDO ENLACE SATELITAL...</div>
    <div id="error-screen" class="hidden">
      <div class="error-box">
        <strong>‚ö†Ô∏è ERROR DE SEGURIDAD</strong><br>
        Conexi√≥n bloqueada por protocolo local.<br>
        <strong>ACCI√ìN:</strong> Ejecute este sistema desde el servidor seguro (GitHub).
      </div>
    </div>

    <div id="view-home" class="hidden">
      <h2 class="section-title">SELECCI√ìN DE OBJETIVO</h2>
      <div class="bank-grid" id="bank-grid-content"></div>
    </div>

    <div id="view-agencies" class="hidden">
      <button class="btn-back" onclick="goHome()">‚¨Ö REGRESAR AL MANDO</button>
      <h2 class="section-title" id="agency-title">PUNTOS DE CONTROL</h2>
      <div class="agency-list" id="agency-list-content"></div>
    </div>

    <div id="view-detail" class="hidden">
      <button class="btn-back" onclick="goBackToAgencies()">‚¨Ö REGRESAR A LISTA</button>
      <div class="detail-card">
        <div class="detail-header">
          <h2 id="d-bank" style="margin:0; font-size:24px; font-weight:900;">BANCO</h2>
          <small id="d-agency" style="color:#ddd; font-size:14px; display:block; margin-top:5px;">Agencia</small>
          <div id="d-addr" style="font-size:11px; margin-top:10px; color:#aaa; border-top:1px solid rgba(255,255,255,0.2); padding-top:10px;">Direcci√≥n...</div>
        </div>
        <div class="detail-body">
          <h3 style="margin-top:0; font-size:12px; color:var(--verde-comando); border-bottom: 2px solid var(--oro); display:inline-block; padding-bottom:3px;">ESCUADRA ASIGNADA:</h3>
          <div id="officers-list" style="margin-top:15px;"></div>
          <a id="btn-map" href="#" class="btn-map" target="_blank">üó∫Ô∏è NAVEGACI√ìN T√ÅCTICA GPS</a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  /* --- CONFIGURACI√ìN --- */
  const PASSWORD_REAL = "BSF2025"; 
  const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSOk3SgSsOLT72VyjISH0aaKjbQojegDPsyOjR2b8VjvsiFpHqvLKcyn5XisYV46Rf4tUx--RsMlyMo/pub?output=csv'; 
  const COLUMNAS = ['ENTIDAD', 'AGENCIA', 'DIRECCION', 'FUNCIONARIO', 'CELULAR', 'HORARIO', 'RIESGO', 'UBICACION_GPS'];

  let fullData = []; let currentBank = '';

  function checkPassword() {
    if(document.getElementById('pass-input').value === PASSWORD_REAL) {
        document.getElementById('view-login').classList.add('hidden');
        document.getElementById('app-container').classList.remove('hidden');
        loadData();
    } else { document.getElementById('login-error').style.display = 'block'; }
  }

  function loadData() {
    fetch(SHEET_URL).then(r=>{if(!r.ok)throw new Error();return r.text()}).then(t=>{fullData=csvAJSON(t);initSystem()})
    .catch(e=>{document.getElementById('loader').classList.add('hidden');document.getElementById('error-screen').classList.remove('hidden')});
  }

  function initSystem() {
    document.getElementById('loader').classList.add('hidden');
    document.getElementById('view-home').classList.remove('hidden');
    renderBanks();
  }

  function renderBanks() {
    const banks = [...new Set(fullData.map(i => i.ENTIDAD).filter(e => e && e.trim()))];
    const grid = document.getElementById('bank-grid-content'); grid.innerHTML = '';
    banks.forEach(b => { 
        grid.innerHTML += `<button class="bank-btn" onclick="goToAgencies('${b}')">
        <div class="bank-icon">üè¶</div>
        <div class="bank-name">${b}</div>
        </button>`; 
    });
  }

  function goToAgencies(bank) {
    currentBank = bank;
    document.getElementById('view-home').classList.add('hidden');
    document.getElementById('view-agencies').classList.remove('hidden');
    document.getElementById('agency-title').innerText = bank;
    const bankData = fullData.filter(i => i.ENTIDAD === bank);
    const uniqueAgencies = new Map();
    bankData.forEach(item => { if(!uniqueAgencies.has(item.AGENCIA)) uniqueAgencies.set(item.AGENCIA, item); });
    const list = document.getElementById('agency-list-content'); list.innerHTML = '';
    uniqueAgencies.forEach((item) => {
      list.innerHTML += `<div class="agency-btn" onclick="goToDetail('${item.AGENCIA}')"><div><strong>${item.AGENCIA}</strong><div style="font-size:11px; color:#555;">${item.DIRECCION.substring(0,30)}...</div></div><div style="font-size:20px;">‚û§</div></div>`;
    });
  }

  function goToDetail(agencyName) {
    const officers = fullData.filter(i => i.ENTIDAD === currentBank && i.AGENCIA === agencyName);
    const info = officers[0];
    document.getElementById('view-agencies').classList.add('hidden');
    document.getElementById('view-detail').classList.remove('hidden');
    document.getElementById('d-bank').innerText = info.ENTIDAD;
    document.getElementById('d-agency').innerText = info.AGENCIA;
    document.getElementById('d-addr').innerText = info.DIRECCION;
    const list = document.getElementById('officers-list'); list.innerHTML = '';
    
    officers.forEach(off => {
        // Icono de silueta generico
        list.innerHTML += `
        <div class="officer-card">
            <div class="officer-name">üëÆ‚Äç‚ôÇÔ∏è ${off.FUNCIONARIO}</div>
            <span class="officer-info">‚è∞ ${off.HORARIO} | üì± ${off.CELULAR}</span>
            <a href="tel:${off.CELULAR}" class="btn-call-mini">üìû LLAMAR</a>
        </div>`;
    });
    
    if(info.UBICACION_GPS) { document.getElementById('btn-map').href = 'https://maps.google.com/?q=' + info.UBICACION_GPS; document.getElementById('btn-map').style.display='block'; }
    else { document.getElementById('btn-map').style.display='none'; }
  }

  function goHome() { document.getElementById('view-agencies').classList.add('hidden'); document.getElementById('view-home').classList.remove('hidden'); }
  function goBackToAgencies() { document.getElementById('view-detail').classList.add('hidden'); document.getElementById('view-agencies').classList.remove('hidden'); }
  function csvAJSON(csv){
    const lines = csv.split('\n'); const res = []; const headers = lines[0].split(',').map(h => h.trim().replace(/\r/g, ''));
    for(let i=1; i<lines.length; i++){
        const obj = {}; const row = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
        if(row.length > 1) { COLUMNAS.forEach(col => { const idx = headers.indexOf(col); obj[col] = (idx > -1 && row[idx]) ? row[idx].replace(/"/g,'').replace(/\r/g,'').trim() : ''; }); res.push(obj); }
    } return res;
  }
</script>
</body>
</html>
