<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIG-BSF | Sistema Oficial</title>
<style>
  /* --- ESTILOS VISUALES --- */
  body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: #eef2f5; margin: 0; padding: 0; user-select: none; }
  .hidden { display: none !important; }

  /* PANTALLA DE LOGIN */
  #view-login { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #002200 0%, #004d00 100%); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; }
  .login-card { background: rgba(255,255,255,0.1); padding: 40px 30px; border-radius: 20px; backdrop-filter: blur(10px); width: 85%; max-width: 320px; border: 1px solid rgba(255,255,255,0.2); }
  .login-input { width: 100%; padding: 12px; margin: 15px 0; border: none; border-radius: 5px; font-size: 16px; text-align: center; outline: none; font-weight: bold; }
  .login-btn { width: 100%; padding: 12px; background: #F3C300; color: #003300; border: none; border-radius: 5px; font-weight: bold; font-size: 16px; cursor: pointer; text-transform: uppercase; }
  .login-error { color: #ff9999; font-size: 13px; margin-top: 10px; display: none; }

  /* CABECERA CON ESCUDOS */
  .header { background: linear-gradient(to bottom, #00381e, #002200); color: white; padding: 10px 15px; border-bottom: 4px solid #F3C300; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: space-between; }
  .header-logo { height: 45px; width: auto; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3)); }
  .header-text { text-align: center; flex-grow: 1; }
  .header h1 { margin: 0; font-size: 14px; font-weight: 800; letter-spacing: 1px; }
  .header p { margin: 2px 0 0; font-size: 10px; color: #F3C300; }

  .container { padding: 20px 15px; max-width: 600px; margin: 0 auto; padding-bottom: 80px; }
  
  /* Botones y Listas */
  .btn-back { background: #2c3e50; color: white; border: none; padding: 10px 15px; border-radius: 8px; margin-bottom: 15px; cursor: pointer; display: inline-flex; align-items: center; font-weight: bold; font-size: 13px; }
  .section-title { color: #00381e; border-left: 5px solid #F3C300; padding-left: 12px; margin-bottom: 20px; font-size: 18px; font-weight: 700; text-transform: uppercase; }

  /* Grid Bancos */
  .bank-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
  .bank-btn { background: white; border: none; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); cursor: pointer; text-align: center; display: flex; flex-direction: column; align-items: center; border-bottom: 3px solid transparent; transition: all 0.2s; }
  .bank-btn:active { transform: scale(0.96); border-bottom: 3px solid #F3C300; }
  .bank-icon { font-size: 28px; margin-bottom: 10px; }
  .bank-name { font-weight: 700; color: #333; font-size: 12px; text-transform: uppercase; }

  /* Lista Agencias */
  .agency-list { display: flex; flex-direction: column; gap: 10px; }
  .agency-btn { background: white; padding: 18px; border-radius: 10px; border-left: 6px solid #00381e; cursor: pointer; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
  
  /* Detalle */
  .detail-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 1px solid #e0e0e0; }
  .detail-header { background: #00381e; color: white; padding: 20px; position: relative; }
  .detail-body { padding: 20px; }
  
  /* Tarjeta de Polic√≠a */
  .officer-card { background: #fcfcfc; border: 1px solid #e0e0e0; border-left: 4px solid #0056b3; border-radius: 8px; padding: 15px; margin-bottom: 15px; position: relative; }
  .officer-name { font-weight: 800; color: #00381e; font-size: 13px; display: block; margin-bottom: 4px; padding-right: 80px; }
  .officer-info { font-size: 12px; color: #555; display: block; margin-bottom: 2px; }
  
  .btn-call-mini { position: absolute; right: 10px; top: 12px; background: #28a745; color: white; padding: 6px 12px; border-radius: 20px; text-decoration: none; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 5px; }
  
  .actions { margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; }
  .btn-map { background-color: #dc3545; width: 100%; display: block; padding: 14px; text-align: center; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 14px; box-shadow: 0 4px 6px rgba(220,53,69,0.2); }

  /* Mensajes */
  #loader, #error-screen { text-align: center; padding: 40px 20px; color: #666; }
  .error-box { background: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 20px; border-radius: 8px; font-size: 13px; text-align: left; }
</style>
</head>
<body>

<div id="view-login">
  <div class="login-card">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/Escudo_de_la_Polic%C3%ADa_Boliviana.png/150px-Escudo_de_la_Polic%C3%ADa_Boliviana.png" style="width:80px; margin-bottom:15px;">
    <h2 style="margin:0 0 5px 0; font-size:18px; color:#F3C300;">ACCESO OFICIAL</h2>
    <p style="font-size:12px; margin-bottom:20px; opacity:0.8;">Ingrese Credenciales</p>
    <input type="password" id="pass-input" class="login-input" placeholder="CONTRASE√ëA">
    <button class="login-btn" onclick="checkPassword()">INGRESAR</button>
    <div id="login-error" class="login-error">üö´ Contrase√±a incorrecta</div>
  </div>
</div>

<div id="app-container" class="hidden">
  
  <div class="header">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/Escudo_de_la_Polic%C3%ADa_Boliviana.png/100px-Escudo_de_la_Polic%C3%ADa_Boliviana.png" class="header-logo">
    <div class="header-text">
      <h1>SIG-BSF LA PAZ</h1>
      <p>Control T√°ctico Digital</p>
    </div>
    <img src="https://cdn-icons-png.flaticon.com/512/942/942749.png" class="header-logo" style="filter: brightness(0) invert(1);">
  </div>

  <div class="container">
    <div id="loader">üîÑ Sincronizando...</div>

    <div id="error-screen" class="hidden">
      <div class="error-box">
        <strong>‚ö†Ô∏è AVISO T√âCNICO</strong><br><br>
        El navegador bloque√≥ la conexi√≥n a Google por seguridad (Modo Escritorio).<br><br>
        <strong>SOLUCI√ìN:</strong> Suba este archivo a <b>GitHub</b> o <b>Tiiny.host</b> para ver los datos reales.
      </div>
    </div>

    <div id="view-home" class="hidden">
      <h2 class="section-title">Entidades</h2>
      <div class="bank-grid" id="bank-grid-content"></div>
    </div>

    <div id="view-agencies" class="hidden">
      <button class="btn-back" onclick="goHome()">‚¨Ö Volver</button>
      <h2 class="section-title" id="agency-title">Agencias</h2>
      <div class="agency-list" id="agency-list-content"></div>
    </div>

    <div id="view-detail" class="hidden">
      <button class="btn-back" onclick="goBackToAgencies()">‚¨Ö Volver</button>
      
      <div class="detail-card">
        <div class="detail-header">
          <h2 id="d-bank" style="margin:0; font-size:18px;">BANCO</h2>
          <small id="d-agency" style="opacity:0.9;">Agencia</small>
          <div id="d-addr" style="font-size: 11px; margin-top: 5px; opacity: 0.8; font-weight:300;">Direcci√≥n...</div>
        </div>
        
        <div class="detail-body">
          <h3 style="margin-top:0; margin-bottom: 20px; font-size:12px; color:#00381e; text-transform:uppercase; border-bottom: 2px solid #F3C300; padding-bottom: 5px; display:inline-block;">Personal Asignado:</h3>
          
          <div id="officers-list"></div>

          <div class="actions">
              <a id="btn-map" href="#" class="btn-map" target="_blank">üó∫Ô∏è UBICACI√ìN T√ÅCTICA (GPS)</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // -----------------------------------------------------------
  // DATOS REALES (YA INSERTADOS)
  // -----------------------------------------------------------
  const PASSWORD_REAL = "BSF2025"; 
  const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSOk3SgSsOLT72VyjISH0aaKjbQojegDPsyOjR2b8VjvsiFpHqvLKcyn5XisYV46Rf4tUx--RsMlyMo/pub?output=csv'; 
  const COLUMNAS = ['ENTIDAD', 'AGENCIA', 'DIRECCION', 'FUNCIONARIO', 'CELULAR', 'HORARIO', 'RIESGO', 'UBICACION_GPS'];
  // -----------------------------------------------------------

  let fullData = [];
  let currentBank = '';

  function checkPassword() {
    const input = document.getElementById('pass-input').value;
    if(input === PASSWORD_REAL) {
        document.getElementById('view-login').classList.add('hidden');
        document.getElementById('app-container').classList.remove('hidden');
        loadData();
    } else {
        document.getElementById('login-error').style.display = 'block';
        document.getElementById('pass-input').value = '';
    }
  }

  function loadData() {
    fetch(SHEET_URL)
      .then(r => { if(!r.ok) throw new Error("Error"); return r.text(); })
      .then(t => { 
          fullData = csvAJSON(t); 
          if(fullData.length === 0) throw new Error("Vacio");
          initSystem(); 
      })
      .catch(e => {
          document.getElementById('loader').classList.add('hidden');
          document.getElementById('error-screen').classList.remove('hidden');
      });
  }

  function initSystem() {
    document.getElementById('loader').classList.add('hidden');
    document.getElementById('view-home').classList.remove('hidden');
    renderBanks();
  }

  function renderBanks() {
    const banks = [...new Set(fullData.map(i => i.ENTIDAD).filter(e => e && e.trim()))];
    const grid = document.getElementById('bank-grid-content');
    grid.innerHTML = '';
    banks.forEach(bank => {
      grid.innerHTML += `<button class="bank-btn" onclick="goToAgencies('${bank}')"><div class="bank-icon">üè¶</div><div class="bank-name">${bank}</div></button>`;
    });
  }

  function goToAgencies(bank) {
    currentBank = bank;
    document.getElementById('view-home').classList.add('hidden');
    document.getElementById('view-agencies').classList.remove('hidden');
    document.getElementById('agency-title').innerText = bank;
    
    const bankData = fullData.filter(i => i.ENTIDAD === bank);
    const uniqueAgencies = new Map();
    bankData.forEach(item => { if(!uniqueAgencies.has(item.AGENCIA)) uniqueAgencies.set(item.AGENCIA, item); });

    const list = document.getElementById('agency-list-content');
    list.innerHTML = '';
    uniqueAgencies.forEach((item, key) => {
      list.innerHTML += `<div class="agency-btn" onclick="goToDetail('${item.AGENCIA}')"><div><strong>${item.AGENCIA}</strong><span style="font-size:11px; color:#666;">${item.DIRECCION.substring(0, 35)}...</span></div><div style="color:#00381e;">‚û§</div></div>`;
    });
  }

  function goToDetail(agencyName) {
    const officers = fullData.filter(i => i.ENTIDAD === currentBank && i.AGENCIA === agencyName);
    const info = officers[0];

    document.getElementById('view-agencies').classList.add('hidden');
    document.getElementById('view-detail').classList.remove('hidden');

    document.getElementById('d-bank').innerText = info.ENTIDAD;
    document.getElementById('d-agency').innerText = info.AGENCIA;
    document.getElementById('d-addr').innerText = info.DIRECCION;

    const container = document.getElementById('officers-list');
    container.innerHTML = '';

    officers.forEach(off => {
        container.innerHTML += `
        <div class="officer-card">
            <span class="officer-name">üëÆ ${off.FUNCIONARIO}</span>
            <span class="officer-info">‚è∞ ${off.HORARIO}</span>
            <span class="officer-info">üì± ${off.CELULAR}</span>
            <a href="tel:${off.CELULAR}" class="btn-call-mini">üìû Llamar</a>
        </div>`;
    });
    
    if (info.UBICACION_GPS) {
        document.getElementById('btn-map').href = 'https://maps.google.com/?q=' + info.UBICACION_GPS;
        document.getElementById('btn-map').style.display = 'block';
    } else {
        document.getElementById('btn-map').style.display = 'none';
    }
  }

  function goHome() {
    document.getElementById('view-agencies').classList.add('hidden');
    document.getElementById('view-home').classList.remove('hidden');
  }

  function goBackToAgencies() {
    document.getElementById('view-detail').classList.add('hidden');
    document.getElementById('view-agencies').classList.remove('hidden');
  }

  function csvAJSON(csv){
    const lineas = csv.split('\n');
    const res = [];
    const headers = lineas[0].split(',').map(h => h.trim().replace(/\r/g, ''));
    for(let i=1; i<lineas.length; i++){
        const obj = {};
        const row = lineas[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
        if(row.length > 1) {
            COLUMNAS.forEach((col) => {
                const idx = headers.indexOf(col);
                obj[col] = (idx > -1 && row[idx]) ? row[idx].replace(/"/g,'').replace(/\r/g,'').trim() : '';
            });
            res.push(obj);
        }
    }
    return res;
  }
</script>
</body>
</html>