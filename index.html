 <!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIG-BSF | Sistema Oficial</title>
<style>
  /* --- ESTILOS VISUALES PREMIUM --- */
  :root { --verde: #00381e; --oro: #F3C300; }
  body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: #eef2f5; margin: 0; padding: 0; }
  .hidden { display: none !important; }

  /* LOGIN */
  #view-login { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #002200, #004d00); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
  .login-card { background: rgba(255,255,255,0.1); padding: 40px; border-radius: 20px; backdrop-filter: blur(10px); width: 85%; max-width: 320px; border: 1px solid rgba(255,255,255,0.2); }
  .login-btn { width: 100%; padding: 15px; background: var(--oro); color: var(--verde); border: none; border-radius: 8px; font-weight: 900; cursor: pointer; margin-top: 20px; }
  .login-input { width: 100%; padding: 15px; border-radius: 8px; border: none; text-align: center; font-weight: bold; box-sizing: border-box; }

  /* CABECERA CON IMAGENES */
  .header { 
    background: linear-gradient(to bottom, #00381e, #001a00); 
    color: white; padding: 10px 15px; 
    border-bottom: 4px solid var(--oro); 
    display: flex; align-items: center; justify-content: space-between; 
    position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  /* Estilo para que las imagenes se vean bien */
  .header-logo { height: 55px; width: auto; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
  .header-text { text-align: center; flex-grow: 1; }
  .header h1 { margin: 0; font-size: 14px; font-weight: 900; }
  .header p { margin: 0; font-size: 10px; color: var(--oro); }

  .container { padding: 20px; max-width: 600px; margin: 0 auto; padding-bottom: 80px; }
  
  /* Botones y Listas */
  .btn-back { background: #2c3e50; color: white; padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; margin-bottom: 20px; font-weight: bold; }
  .section-title { color: var(--verde); border-left: 5px solid var(--oro); padding-left: 15px; margin-bottom: 20px; font-size: 18px; font-weight: 800; }

  .bank-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
  .bank-btn { background: white; border: none; padding: 25px 10px; border-radius: 15px; box-shadow: 0 5px 10px rgba(0,0,0,0.05); cursor: pointer; display: flex; flex-direction: column; align-items: center; }
  .bank-icon { font-size: 30px; margin-bottom: 10px; }
  
  .agency-list { display: flex; flex-direction: column; gap: 10px; }
  .agency-btn { background: white; padding: 20px; border-radius: 10px; border-left: 6px solid var(--verde); cursor: pointer; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

  .detail-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
  .detail-header { background: var(--verde); color: white; padding: 20px; }
  .detail-body { padding: 20px; }

  .officer-card { background: #f8f9fa; border-left: 5px solid #0056b3; border-radius: 8px; padding: 15px; margin-bottom: 15px; position: relative; }
  .btn-call-mini { position: absolute; right: 10px; top: 15px; background: #28a745; color: white; padding: 5px 12px; border-radius: 20px; text-decoration: none; font-size: 11px; font-weight: bold; }
  .btn-map { background: #dc3545; color: white; display: block; padding: 15px; text-align: center; text-decoration: none; border-radius: 10px; font-weight: bold; margin-top: 20px; }

  #loader, #error-screen { text-align: center; padding: 50px 20px; color: #666; }
</style>
</head>
<body>

<div id="view-login">
  <div class="login-card">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/Escudo_de_la_Polic%C3%ADa_Boliviana.png/150px-Escudo_de_la_Polic%C3%ADa_Boliviana.png" style="width:80px; margin-bottom:15px;">
    <h2 style="margin:0; color:var(--oro);">ACCESO OFICIAL</h2>
    <p style="color:white; margin-bottom:20px; font-size:12px;">SIG-BSF LA PAZ</p>
    <input type="password" id="pass-input" class="login-input" placeholder="CONTRASE√ëA">
    <button class="login-btn" onclick="checkPassword()">INGRESAR</button>
    <div id="login-error" style="color:#ff9999; margin-top:10px; display:none;">Contrase√±a Incorrecta</div>
  </div>
</div>

<div id="app-container" class="hidden">
  
  <div class="header">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/Escudo_de_la_Polic%C3%ADa_Boliviana.png/100px-Escudo_de_la_Polic%C3%ADa_Boliviana.png" class="header-logo">
    
    <div class="header-text">
      <h1>BATALL√ìN LA PAZ</h1>
      <p>SEGURIDAD F√çSICA</p>
    </div>
    
    <img src="logo.png" class="header-logo" onerror="this.style.opacity='0'">
  </div>

  <div class="container">
    <div id="loader">üîÑ Sincronizando...</div>
    <div id="error-screen" class="hidden">‚ö†Ô∏è Error de conexi√≥n. Revise internet.</div>

    <div id="view-home" class="hidden">
      <h2 class="section-title">Entidades</h2>
      <div class="bank-grid" id="bank-grid-content"></div>
    </div>

    <div id="view-agencies" class="hidden">
      <button class="btn-back" onclick="goHome()">‚¨Ö VOLVER</button>
      <h2 class="section-title" id="agency-title">Agencias</h2>
      <div class="agency-list" id="agency-list-content"></div>
    </div>

    <div id="view-detail" class="hidden">
      <button class="btn-back" onclick="goBackToAgencies()">‚¨Ö VOLVER</button>
      <div class="detail-card">
        <div class="detail-header">
          <h2 id="d-bank" style="margin:0;">BANCO</h2>
          <small id="d-agency">Agencia</small>
          <div id="d-addr" style="font-size:11px; margin-top:5px;">Direcci√≥n...</div>
        </div>
        <div class="detail-body">
          <h3 style="margin-top:0; font-size:12px; color:#00381e;">PERSONAL ASIGNADO:</h3>
          <div id="officers-list"></div>
          <a id="btn-map" href="#" class="btn-map" target="_blank">üó∫Ô∏è UBICACI√ìN GPS</a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const PASSWORD_REAL = "BSF2025"; 
  const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSOk3SgSsOLT72VyjISH0aaKjbQojegDPsyOjR2b8VjvsiFpHqvLKcyn5XisYV46Rf4tUx--RsMlyMo/pub?output=csv'; 
  const COLUMNAS = ['ENTIDAD', 'AGENCIA', 'DIRECCION', 'FUNCIONARIO', 'CELULAR', 'HORARIO', 'RIESGO', 'UBICACION_GPS'];
  let fullData = []; let currentBank = '';

  function checkPassword() {
    if(document.getElementById('pass-input').value === PASSWORD_REAL) {
        document.getElementById('view-login').classList.add('hidden');
        document.getElementById('app-container').classList.remove('hidden');
        loadData();
    } else { document.getElementById('login-error').style.display = 'block'; }
  }

  function loadData() {
    fetch(SHEET_URL).then(r=>{if(!r.ok)throw new Error();return r.text()}).then(t=>{fullData=csvAJSON(t);initSystem()})
    .catch(e=>{document.getElementById('loader').classList.add('hidden');document.getElementById('error-screen').classList.remove('hidden')});
  }

  function initSystem() {
    document.getElementById('loader').classList.add('hidden');
    document.getElementById('view-home').classList.remove('hidden');
    renderBanks();
  }

  function renderBanks() {
    const banks = [...new Set(fullData.map(i => i.ENTIDAD).filter(e => e && e.trim()))];
    const grid = document.getElementById('bank-grid-content'); grid.innerHTML = '';
    banks.forEach(b => { grid.innerHTML += `<button class="bank-btn" onclick="goToAgencies('${b}')"><div class="bank-icon">üè¶</div><div style="font-weight:bold; font-size:12px;">${b}</div></button>`; });
  }

  function goToAgencies(bank) {
    currentBank = bank;
    document.getElementById('view-home').classList.add('hidden');
    document.getElementById('view-agencies').classList.remove('hidden');
    document.getElementById('agency-title').innerText = bank;
    const bankData = fullData.filter(i => i.ENTIDAD === bank);
    const uniqueAgencies = new Map();
    bankData.forEach(item => { if(!uniqueAgencies.has(item.AGENCIA)) uniqueAgencies.set(item.AGENCIA, item); });
    const list = document.getElementById('agency-list-content'); list.innerHTML = '';
    uniqueAgencies.forEach((item) => {
      list.innerHTML += `<div class="agency-btn" onclick="goToDetail('${item.AGENCIA}')"><div><strong>${item.AGENCIA}</strong><div style="font-size:11px; color:#666;">${item.DIRECCION.substring(0,30)}...</div></div><div>‚û§</div></div>`;
    });
  }

  function goToDetail(agencyName) {
    const officers = fullData.filter(i => i.ENTIDAD === currentBank && i.AGENCIA === agencyName);
    const info = officers[0];
    document.getElementById('view-agencies').classList.add('hidden');
    document.getElementById('view-detail').classList.remove('hidden');
    document.getElementById('d-bank').innerText = info.ENTIDAD;
    document.getElementById('d-agency').innerText = info.AGENCIA;
    document.getElementById('d-addr').innerText = info.DIRECCION;
    const list = document.getElementById('officers-list'); list.innerHTML = '';
    officers.forEach(off => {
        list.innerHTML += `<div class="officer-card"><strong style="color:#00381e;">üëÆ ${off.FUNCIONARIO}</strong><br><span style="font-size:12px;">‚è∞ ${off.HORARIO} | üì± ${off.CELULAR}</span><a href="tel:${off.CELULAR}" class="btn-call-mini">üìû</a></div>`;
    });
    if(info.UBICACION_GPS) { document.getElementById('btn-map').href = 'https://maps.google.com/?q=' + info.UBICACION_GPS; document.getElementById('btn-map').style.display='block'; }
    else { document.getElementById('btn-map').style.display='none'; }
  }

  function goHome() { document.getElementById('view-agencies').classList.add('hidden'); document.getElementById('view-home').classList.remove('hidden'); }
  function goBackToAgencies() { document.getElementById('view-detail').classList.add('hidden'); document.getElementById('view-agencies').classList.remove('hidden'); }
  function csvAJSON(csv){
    const lines = csv.split('\n'); const res = []; const headers = lines[0].split(',').map(h => h.trim().replace(/\r/g, ''));
    for(let i=1; i<lines.length; i++){
        const obj = {}; const row = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
        if(row.length > 1) { COLUMNAS.forEach(col => { const idx = headers.indexOf(col); obj[col] = (idx > -1 && row[idx]) ? row[idx].replace(/"/g,'').replace(/\r/g,'').trim() : ''; }); res.push(obj); }
    } return res;
  }
</script>
</body>
</html>
